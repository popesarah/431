---
title: "Getting Started with R"
author: "Thomas E. Love"
date: "`r Sys.Date()`"
output:
    pdf_document:
        number_sections: yes
        toc: yes
linkcolor: blue
---

\newpage

# Purpose of this Document

This is meant to walk you through the steps of completing some elementary analyses using R, R Studio, and R Markdown. Working through this document will definitely help you get rolling on Assignment 1.

## Preliminary Steps

1. Follow the [instructions to install R, R Studio and the R packages and data and code that we'll use in 431](https://github.com/THOMASELOVE/431/blob/master/software-installation-431.md). Once you have these things installed, you're ready for the steps below.
2. Select or create a subdirectory on your computer for your project. We'll call that your **project folder**.
    + Don't use the same subdirectory/folder for multiple projects. You'll have many projects this semester.
    + A good directory path might be something like `pqhs431/2017-08-29_my-first-R-project`
    + You won't believe how important it is for you to understand where your files are and a well-designed naming scheme is an enormous time-saver. "A place for everything, and everything in its place" and all that...
3. Put any data you plan to import into R, and a copy of the `431-r-template.Rmd` file into your project folder.
4. Start R Studio and begin by opening up a **project**.
    + Use **File ... New Project** to create a new project in your **project folder**.
        + Create the R project in the main **project folder**, regardless of whether you've placed the data in that same folder, or in a data subdirectory of that folder.
        + One and only one R Project per project folder is the way to happiness.
    + When not doing this for the first time, use **File ... Open Project** to open an R Studio Project you've already created.

## Use the template

A R Markdown file is just a plain text document, with interspersed R code that lets you produce reports that combine narration with results, and that can be easily exported as an HTML, Word or PDF file. It's a great tool. Dr. Love builds virtually everything you'll see in this class with R Markdown. R Markdown files use the `.Rmd` extension.

Open the template file `431-r-template.Rmd` by clicking on it in the **Files** tab on the lower right of your R Studio setup, or selecting **File ... Open** from the main menu.
    + The start of the template file is a top-line set of instructions to R Markdown about how to process the rest of the document. It is referred to as the YAML material, and looks like this:

```
---
title: "R Markdown Template"
author: "Your Name"
date: "`r Sys.Date()`"
output:
  html_document: 
    toc: yes
    code_folding: show
---
```

Now, edit the file to include a meaningful Title for this work, and place your actual name in the author section. Then use **File ... Save as** to save the Markdown file under a new project-specific name, rather than the generic `431-r-template.Rmd`. Your result should look something like this:

```
---
title: "My extremely exciting first data analysis"
author: "Chris Traeger"
date: "`r Sys.Date()`"
output:
  html_document: 
    toc: yes
    code_folding: show
---
```

In most cases, changing only the **title**, **author** and **date**, but otherwise leaving this as is, will work well for our purposes.

To learn more about using R Markdown, we recommend working through some of the tutorials at http://rmarkdown.rstudio.com/lesson-1.html

# Loading the Packages

To begin, we'll load the packages (libraries) and set up options that we will use in our analyses. 

```{r set-options and load packages, message=FALSE}
knitr::opts_chunk$set(comment=NA)

library(magrittr); library(tidyverse)
```

# The chickwts study

The `chickwts` data, available as part of the base installation of R (in the `datasets` package) describe an experiment conducted to measure and compare the effectiveness of various feed supplements on the growth rate of chickens. For more on the `chickwts` data, type `?(chickwts)` into the R console.

We'll begin by placing the data in a tibble called `chick`.

```{r place chickwts data frams into a tibble called chick}
chick <- tbl_df(chickwts)
chick
```

- The `weight` variable is numeric (double-precision) and gives the chick's weight.
- The `feed` variable is categorical (a factor in R) and gives the feed type.

## Summarizing the distribution of a categorical variable, `feed`

The regular `summary` function can provide some useful results.

```{r summary for feed data}
chick %>% 
    select(feed) %>% 
    summary()
```

There are lots of ways to generate a table for a factor (categorical variable) like this.

```{r table for feed}
chick %>%
  select(feed) %>%
    table() %>%
    addmargins() 
```

## Describing the distribution of a continuous variable, `weight`, numerically

The regular `summary` function provides a five-number summary, plus the mean. We can do this with ...

```{r numerical-summary-for-weight-approach-1}
chick %>%
    select(weight) %>%
    summary()
```

Or, we can use a different pipe than the usual `%>%` - here `%$%` exposes the pieces of the `chick` tibble (the variables) to the function `summary()`.

```{r numerical summary for weight data}
chick %$% summary(weight)
```

The `favstats` function from the `mosaic` package produces a more extensive set of numerical summaries. Here, we are forced to use the new pipe `%$%` to identify the variables for the function `favstats` in `mosaic`.

```{r favstats summary for weight data}
chick %$%
    mosaic::favstats(weight)
```

Another way to accomplish the same end is

```{r favstats summary for weight data 2}
mosaic::favstats(chick$weight)
```

Here is a smaller numerical summary of the weights broken down by feed category.

```{r summary of weights by feed category}
chick %>%
  group_by(feed) %>%
  summarize(mean(weight), sd(weight), median(weight))
```

\newpage

## Drawing an attractive histogram of the `weight` data

Here is the default approach.
```{r histogram 1 for weight data}
ggplot(chick, aes(x = weight)) +
  geom_histogram()
```

\newpage

Let's make that slightly more attractive, revise the labels, and place a title.

```{r histogram 2 for weight data}
ggplot(chick, aes(x = weight)) +
  geom_histogram(bins = 10, color = "black", fill = "turquoise") + 
  labs(x = "Chick's Weight", y = "Number of Chicks", 
       title = "Size of 71 Chicks in the chickwts data")
```

\newpage

Another option would be to plot the density function, rather than the raw counts, and compare it directly to what we would expect from a Normal model with the same mean and standard deviation as the weights in the `chick` data.

```{r histogram 3 for weight data}
ggplot(chick, aes(x = weight)) +
  geom_histogram(aes(y = ..density..), bins = 12, color = "white", fill = "turquoise") + 
  stat_function(fun = dnorm,
                args = list(mean = mean(chick$weight), sd = sd(chick$weight)),
                lwd = 1.5, col = "violetred") +
  labs(x = "Chick's Weight", y = "Probability Density", 
       title = "Size of 71 Chicks in the chickwts data",
       subtitle = "with superimposed Normal density function")
```

\newpage

## Drawing a Boxplot of the Weights by Feed Type

A boxplot might, for instance, compare the weight distributions for each of the various types of feed.

```{r boxplot for weight by feed}
ggplot(chick, aes(x = feed, y = weight, fill = feed)) +
    geom_boxplot() +
    labs(title = "Weight by Feed Type in the Chickwts data")
```

We could drop the labels on the right hand side by adding `guides(fill = FALSE) +` somewhere in our `ggplot` call.

\newpage

## Drawing a Normal Q-Q plot of the Weights

A Normal Q-Q plot of the weights is probably most easily obtained using base graphics, rather than ggplot. For example, 

```{r qq plot of the weight data}
qqnorm(chick$weight, main = "Normal Q-Q plot of Chick Weights")
qqline(chick$weight, col = "red")
```

\newpage

# The Orange Study

The Orange data frame has 35 rows and 3 columns of records of the growth of orange trees. Let's get the data into a tibble.

```{r place Orange data frams into a tibble called orange}
orange <- tbl_df(Orange)
orange
```

- `tree` is an ordinal factor, which indicates the tree on which the measurement was made. The ordering is by increaing maximum diameter of the five trees.
- `age` is a numerical variable, containing the age of the tree as measured in days since 1968-12-31.
- `circumference` is a numerical variable, containing the trunk circumference (probably at "breast height") in mm.

## Numerical Summary

And here's the standard numerical summary for the full data set. 

```{r numerical summary for orange tibble}
summary(orange)
```

Next, we'll look at the mean age and circumference, within each of the seven measurements per tree.

```{r numerical summary for age and circumference by tree}
orange %>%
  group_by(Tree) %>%
  summarize(mean(age), mean(circumference))
```
It looks like each of the trees was measured at exactly the same time (age).

```{r table of age by tree}
table(orange$age, orange$Tree) 
```
Yes, each tree was measured at precisely the same five times.

## Correlation between Age and Circumference

Here's another case that calls for the `%$%` pipe.

```{r correlation of age and circumference 1}
orange %$% cor(age, circumference)
```

Or, obtain the identical result with...

```{r correlation of age and circumference 2}
cor(orange$age, orange$circumference)
```

The Pearson correlation of age and circumference is `r signif(cor(orange$age, orange$circumference),2)` which is pretty strong, indicating that we'd expect to see a fairly positive and mostly linear association in a scatterplot. So, let's see if that's what we get.

\newpage

## Scatterplot predicting Circumference using Age across all Trees

```{r scatterplot 1 for orange}
ggplot(orange, aes(x = age, y = circumference)) +
  geom_point()
```

OK. Let's add a linear model to this plot, as well as some better labels, and we'll change from mapping the points as observed to using `geom_jitter` to add a little horizontal (x-axis) jitter to the points, so that we don't have so much overlap.

\newpage

## Scatterplot with Linear Fit predicting Circumference using Age across all Trees

```{r scatterplot 2 for orange}
ggplot(orange, aes(x = age, y = circumference)) +
    geom_jitter(width = 20, height = 0) + 
    geom_smooth(method = "lm", col = "orange") +
    labs(title = "Growth of Orange Trees", 
         x = "Age (days since 1968-12-31)", 
         y = "Circumference in mm") +
    theme_bw()
```

\newpage

## The Linear Model

The linear model fitted here is summarized below:

```{r fit linear model to orange circumference as a function of age}
model1 <- lm(circumference ~ age, data = orange)
summary(model1)
```

So the linear regression model is: circumference = `r signif(coef(model1)[1], 3)` + `r signif(coef(model1)[2], 3)` age.

So our predicted circumference for a tree of age 1000 days is `r signif(coef(model1)[1] + coef(model1)[2]*1000,3)` mm.

\newpage

## Some Other Scatterplots: Assessing each Tree separately

As a third option, let's fit separate smooth (`loess`) curves to each of the five individual trees, and plot each of them in different colors.

```{r scatterplot 3 for orange}
ggplot(orange, aes(x = age, y = circumference, col = Tree)) +
  geom_point() + 
  geom_smooth(method = "loess", se = FALSE) +
  labs(title = "Growth of Orange Trees, with Scatterplot Smooths", 
       x = "Age (days since 1968-12-31)", y = "Circumference in mm")
```

\newpage

Or we could facet the plots, showing multiple scatterplots, one for each Tree.

```{r scatterplot 4 for orange}
ggplot(orange, aes(x = age, y = circumference, col = Tree)) +
  geom_point() + 
  geom_smooth(method = "loess", se = FALSE) +
  facet_wrap(~ Tree) +
  guides(col = FALSE) +
  labs(title = "Growth of Orange Trees over Time, with Scatterplot Smooths", 
       x = "Days since 1968-12-31", y = "Circumference (in mm)")
```

\newpage

# Getting Data into R from Excel or another Software Package: The Fundamentals

The easiest way to get data from another software package into R is to save the file (from within the other software package) in a form that R can read.  What you want is to end up with an Excel file that looks like this...

![An Excel sheet with a tidy data set](images/sheet1.png)

This *tidy* data set contains:

- one row for each subject
- variables that indicate characteristics of each of the subjects

The variable names are in the first row, and the data are in the remaining rows (2-10 in this small example). Categorical variables are most easily indicated by letters (drug A or B, for instance) while continuous variables, like response, are indicated by numbers. Leave missing cells blank or use the symbol `NA`, rather than indicating them with, say, `-99` or some other code.

Within Excel, this file can be saved as a `.csv` (comma-separated text file) or just as an Excel .XLS file, and then imported directly into R, via RStudio by clicking Import Dataset under the Workspace tab, then selecting From Text File. If you've saved the file in Excel as a `.csv` file, RStudio will generally make correct guesses about how to import the file.  Once imported, you just need to save the workspace when you quit RStudio and you'll avoid the need to re-import.

